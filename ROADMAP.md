# Дорожная карта улучшения Pose Estimation в SensumApp

## Фаза 0: Рефакторинг архитектуры (MVVM-C)

-   [ ] **Базовая структура:**
    -   [ ] Переименовать `LevelingViewController` в `ExerciseExecutionViewController`.
    -   [ ] Создать пустые файлы для `ExerciseSelectionViewController` и `ExerciseSelectionViewModel`.
    -   [ ] Создать модель `Exercise` (структура с `id`, `name`, `description`, `iconName`).
    -   [ ] Обновить `LevelingCoordinator` для старта с `ExerciseSelectionViewController`.
-   [ ] **Экран выбора упражнений (`ExerciseSelection`):**
    -   [ ] Реализовать UI (`UITableView` или `UICollectionView`) в `ExerciseSelectionViewController`.
    -   [ ] Реализовать `ExerciseSelectionViewModel` (загрузка моковых данных упражнений, предоставление данных для View).
    -   [ ] Настроить навигацию: ViewModel сообщает координатору о выборе, координатор показывает `ExerciseExecutionViewController`.
-   [ ] **Экран выполнения упражнений (`ExerciseExecution`):**
    -   [ ] Создать `ExerciseExecutionViewModel`.
    -   [ ] Перенести логику управления `PoseLandmarkerHelper` и `ExerciseAnalyzer` из View во ViewModel.
    -   [ ] Перенести логику состояния тренировки (таймер, счетчики) во ViewModel.
    -   [ ] Перенести логику расчета XP и атрибутов во ViewModel.
    -   [ ] Перенести взаимодействие с `DataManager` во ViewModel.
    -   [ ] Настроить связь ViewModel -> View для обновления UI (делегат/замыкания/Combine).
    -   [ ] `ExerciseExecutionViewController` становится тоньше, отвечает за UI и передачу событий.
-   [ ] **Анализаторы упражнений:**
    -   [ ] Создать протокол/базовый класс `ExerciseAnalyzer`.
    -   [ ] Переименовать `SquatAnalyzer` в `SquatAnalyzer3D` и адаптировать под `ExerciseAnalyzer`.
    -   [ ] `ExerciseExecutionViewModel` создает нужный анализатор в зависимости от выбранного упражнения.
-   [ ] **Отрисовка позы:**
    -   [ ] Переименовать `PoseOverlayView` в `PoseOverlayView2D` (если хотим сохранить старую реализацию).
    -   [ ] Создать `PoseOverlayView3D` для отрисовки 3D-точек (проецируя их).
    -   [ ] `ExerciseExecutionViewController` использует `PoseOverlayView3D`.

## Фаза 1: Фундамент (3D и Оптимизация)

-   [ ] **Переход на 3D (`poseWorldLandmarks`):**
    -   [ ] Обновить `PoseLandmarkerHelper` для извлечения `poseWorldLandmarks`.
    -   [ ] Переписать `SquatAnalyzer` для работы с 3D-координатами и расчета углов в 3D.
    -   [ ] (В будущем) Адаптировать анализ для других упражнений под 3D.
-   [ ] **Оптимизация под iOS:**
    -   [ ] Убедиться, что используется GPU-делегат MediaPipe (`computeDelegate: .GPU`).
    -   [ ] Исследовать возможность и сложность конвертации модели MediaPipe Pose в Core ML для использования Neural Engine (ANE).
    -   [ ] (Позже) Оптимизировать код пост-обработки (анализаторы упражнений).
-   [ ] **Специализация анализа:**
    -   [ ] Определить наборы ключевых 3D-точек и углов для приседаний.
    -   [ ] (В будущем) Определить наборы для других упражнений.

## Фаза 2: Устойчивость и Точность

-   [ ] **Плохая освещенность/Шум:**
    -   [ ] Оценить работу текущей модели в сложных условиях.
    -   [ ] (Если необходимо) Исследовать/реализовать базовые техники улучшения изображения (яркость/контраст, простые фильтры шума).
    -   [ ] (Продвинуто) Исследовать нейросетевые подходы к Low-Light Enhancement / Denoising.
-   [ ] **Окклюзии (Базово):**
    -   [ ] Оценить устойчивость текущего трекинга MediaPipe.
    *   [ ] (Если необходимо) Исследовать/реализовать Фильтр Калмана для сглаживания и краткосрочного предсказания `poseWorldLandmarks`.

## Фаза 3: Революционные возможности

-   [ ] **Точная 3D-реконструкция (Mesh Recovery):**
    -   [ ] Исследовать существующие модели (SPIN, PARE, CLIFF и т.д.) и возможность их интеграции/запуска на iOS.
    -   [ ] (Опционально) Оценить использование данных с LiDAR/TrueDepth через ARKit.
-   [ ] **Предсказание и анализ динамики (Временные модели):**
    -   [ ] Исследовать применение LSTM/Трансформеров к последовательностям 3D-поз.
    -   [ ] Собрать или найти датасеты с 3D-позами во времени.
-   [ ] **Биомеханический анализ:**
    -   [ ] Исследовать создание упрощенной физической модели скелета.
    -   [ ] Разработать методы оценки качества движения и нагрузок на основе 3D-позы и модели.
-   [ ] **Собственные модели (При необходимости):**
    -   [ ] Оценить необходимость разработки собственных моделей (Pose, Mesh, Temporal).
    -   [ ] Исследовать техники обучения (GAN, Self-Supervised, NAS, Knowledge Distillation).
